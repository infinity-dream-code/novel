<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kasus: Malam di Vila Cempaka ‚Äî Game Detektif</title>
  <style>
    :root{
      --bg:#0f1115;
      --panel:#171a20;
      --muted:#9aa4b2;
      --text:#eaeef5;
      --accent:#7c9cff;
      --accent-2:#62d4a0;
      --danger:#ff6b6b;
      --warn:#ffd166;
      --shadow: 0 8px 24px rgba(0,0,0,.35);
      --radius:14px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif;
      background: radial-gradient(1200px 800px at 10% -10%, #1d2230 0%, var(--bg) 50%);
      color:var(--text);
    }

    header{
      position:sticky; top:0; z-index:5;
      background:linear-gradient(180deg, rgba(15,17,21,.95) 0%, rgba(15,17,21,.6) 100%);
      backdrop-filter: blur(8px);
      border-bottom:1px solid rgba(255,255,255,.06);
    }
    .wrap{max-width:1200px; margin:0 auto; padding: 16px}
    .title{
      display:flex; align-items:center; gap:14px;
    }
    .badge{
      display:inline-flex; align-items:center; gap:8px;
      padding:6px 10px; border-radius:999px;
      background:#12151b; border:1px solid rgba(255,255,255,.08);
      color:var(--muted); font-size:12px; letter-spacing:.3px;
    }
    .grid{
      display:grid; gap:16px; margin:16px auto;
      grid-template-columns: 1fr;
    }
    @media (min-width: 980px){
      .grid{ grid-template-columns: 1.1fr .9fr }
    }

    .panel{
      background:linear-gradient(180deg, #171a20, #141821);
      border:1px solid rgba(255,255,255,.08);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .panel h2{ margin:0; font-size:16px; letter-spacing:.4px; color:#c6d2e1; padding:14px 16px; border-bottom:1px solid rgba(255,255,255,.06); background:rgba(255,255,255,.02)}
    .panel .body{ padding:14px; }

    .locations{
      display:grid; grid-template-columns: repeat(2, minmax(0,1fr)); gap:12px;
    }
    @media (min-width: 640px){
      .locations{ grid-template-columns: repeat(3, minmax(0,1fr));}
    }
    .card{
      background:linear-gradient(180deg,#1b202b,#141821);
      border:1px solid rgba(255,255,255,.08);
      border-radius:12px; padding:12px; cursor:pointer;
      display:flex; gap:10px; align-items:center; transition: transform .15s ease, border-color .2s ease;
      min-height:64px;
    }
    .card[aria-disabled="true"]{ opacity:.55; cursor:not-allowed }
    .card:hover{ transform: translateY(-2px); border-color: rgba(124,156,255,.6)}
    .card .emoji{ font-size:22px }
    .card .name{ font-weight:600 }
    .card small{ color:var(--muted) }

    .clues{ display:grid; grid-template-columns:1fr; gap:10px }
    .clue{
      padding:12px; border:1px dashed rgba(255,255,255,.18);
      border-radius:10px; background: rgba(255,255,255,.02);
      display:flex; justify-content:space-between; gap:10px; align-items:flex-start;
    }
    .clue .txt{ font-size:14px }
    .clue button{ white-space:nowrap }

    .suspects{ display:grid; grid-template-columns:1fr 1fr; gap:10px }
    @media (min-width: 520px){ .suspects{ grid-template-columns:1fr 1fr 1fr 1fr } }
    .sus{ background:linear-gradient(180deg,#1b202b,#131822);
      border:1px solid rgba(255,255,255,.08);
      border-radius:12px; padding:10px; display:flex; gap:10px; align-items:flex-start; position:relative;
    }
    .sus .pfp{ font-size:28px; line-height:1 }
    .sus .nm{ font-weight:700; }
    .sus .meta{ color:var(--muted); font-size:12px }
    .tag{
      display:inline-flex; align-items:center; gap:6px; padding:4px 8px; font-size:11px;
      border-radius:999px; border:1px solid rgba(255,255,255,.1); color:#cdd7e6; background:rgba(255,255,255,.03)
    }
    .tag.ok{ border-color: rgba(98,212,160,.5); color: #bff1db }
    .tag.no{ border-color: rgba(255,107,107,.5); color: #ffd0d0 }

    .toolbar{ display:flex; gap:10px; flex-wrap:wrap; }
    button{
      appearance:none; border:1px solid rgba(255,255,255,.1); background: #11151d;
      color:#eaf0ff; padding:10px 12px; border-radius:10px; cursor:pointer; font-weight:600;
      transition:transform .1s ease, background .2s ease, border-color .2s ease;
    }
    button:hover{ transform: translateY(-1px); border-color: var(--accent); }
    button.primary{ background: linear-gradient(180deg, #29314a, #22283a); border-color: rgba(124,156,255,.6); }
    button[disabled]{ opacity:.5; cursor:not-allowed }

    .notebook{ width:100%; min-height:120px; resize:vertical; padding:12px; background:#0f131b; color:#dbe6ff; border:1px solid rgba(255,255,255,.1); border-radius:10px}
    .log{ font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; background:#0a0d12; border:1px solid rgba(255,255,255,.08); border-radius:10px; padding:10px; max-height:220px; overflow:auto; color:#c8d2e3 }
    .log p{ margin:0 0 6px }
    .muted{ color:var(--muted) }

    dialog{
      border:none; border-radius:16px; max-width:520px; width:calc(100% - 24px);
      background:linear-gradient(180deg,#1b202b,#121723); color:var(--text);
      border:1px solid rgba(255,255,255,.08); box-shadow: var(--shadow);
      padding:0;
    }
    dialog::backdrop{ background: rgba(0,0,0,.45); backdrop-filter: blur(2px) }
    .modal-head{ padding:14px 16px; border-bottom:1px solid rgba(255,255,255,.06); font-weight:700 }
    .modal-body{ padding:16px; display:grid; gap:12px }
    .radio{ display:flex; gap:10px; align-items:flex-start; padding:10px; border:1px solid rgba(255,255,255,.08); border-radius:10px }
    .success{ border-left:4px solid var(--accent-2); padding:10px; background:rgba(98,212,160,.06)}
    .danger{ border-left:4px solid var(--danger); padding:10px; background:rgba(255,107,107,.06)}
    .chips{ display:flex; gap:6px; flex-wrap:wrap }
    .tiny{ font-size:12px }
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <div class="title">
        <div class="badge">üïµÔ∏è‚Äç‚ôÄÔ∏è Kasus Interaktif</div>
        <h1 style="font-size:20px; margin:8px 0">Malam di Vila Cempaka</h1>
        <span class="badge" id="progressBadge" aria-live="polite">Bukti kunci: 0/4</span>
        <span class="badge">Langkah: <span id="steps">0</span></span>
        <div style="flex:1"></div>
        <button id="resetBtn" title="Mulai ulang kasus">üîÑ Reset</button>
      </div>
    </div>
  </header>

  <main class="wrap grid" id="app">
    <section class="panel">
      <h2>üó∫Ô∏è Lokasi</h2>
      <div class="body">
        <div class="locations" id="locations"></div>
        <hr style="border-color: rgba(255,255,255,.08); margin:14px 0">
        <div id="clueArea">
          <div class="muted tiny">Pilih lokasi untuk melihat petunjuk‚Ä¶</div>
        </div>
      </div>
    </section>

    <aside class="panel">
      <h2>üßë‚Äçü§ù‚Äçüßë Suspek & Deduksi</h2>
      <div class="body" id="suspectArea">
        <div class="suspects" id="suspects"></div>
        <div style="height:10px"></div>
        <div class="toolbar">
          <button class="primary" id="accuseBtn" disabled>‚öñÔ∏è Ajukan Tuduhan</button>
          <button id="interrogateBtn">üí¨ Interogasi Terbatas</button>
        </div>
        <p class="tiny muted">Catatan: tombol tuduhan aktif setelah 4 bukti kunci ditemukan.</p>
      </div>
    </aside>

    <section class="panel" style="grid-column:1 / -1">
      <h2>üìí Notebook & Log</h2>
      <div class="body">
        <div class="toolbar" style="margin-bottom:8px">
          <button id="copyNotes">üìã Salin Catatan</button>
        </div>
        <textarea class="notebook" id="notes" placeholder="Tulis hipotesis, timeline, atau hubungan antar tokoh di sini‚Ä¶"></textarea>
        <div style="height:12px"></div>
        <div class="log" id="log" aria-live="polite"></div>
      </div>
    </section>
  </main>

  <!-- Modal Tuduhan -->
  <dialog id="accuseModal" aria-labelledby="accuseTitle">
    <div class="modal-head" id="accuseTitle">Ajukan Tuduhan</div>
    <form method="dialog" class="modal-body" id="accuseForm">
      <div class="tiny muted">Pilih pelaku menurut deduksi kamu. (Tips: Periksa status ‚ÄúMungkin‚Äù di kartu suspek.)</div>
      <div id="accuseList"></div>
      <div>
        <div class="tiny muted" style="margin-bottom:6px">Sertakan bukti pendukung (otomatis terisi dari bukti kunci):</div>
        <div class="chips" id="proofChips"></div>
      </div>
      <div class="toolbar">
        <button value="cancel">Tutup</button>
        <button class="primary" value="submit">Kunci Tuduhan</button>
      </div>
    </form>
  </dialog>

  <!-- Modal Interogasi -->
  <dialog id="askModal" aria-labelledby="askTitle">
    <div class="modal-head" id="askTitle">Interogasi Singkat</div>
    <form method="dialog" class="modal-body" id="askForm">
      <div class="tiny muted">Kamu punya <b id="qLeft">8</b> pertanyaan lagi.</div>
      <div class="chips" id="askTargets"></div>
      <div id="askOutput" class="tiny muted"></div>
      <div class="toolbar">
        <button value="cancel">Tutup</button>
      </div>
    </form>
  </dialog>

  <script>
  // ---------- DATA KASUS ----------
  const SUSPECTS = [
    { id:'rina', emoji:'üï∂Ô∏è', name:'Rina Putri', role:'Fotografer lepas',
      left:true, shoe:38, perfume:'Nocturne',
      bio:'Kenalan lama korban. Sering meliput acara vila.',
      alibi:'Mengaku di teras melakukan panggilan telepon.',
      qa:{
        default:'‚ÄúAku hanya mampir sebentar untuk ambil lensa.‚Äù',
        relation:'‚ÄúKami sempat berdebat soal artikel, tapi itu biasa.‚Äù',
        perfume:'‚Äú‚Ä¶aku suka parfum malam. Kenapa?‚Äù',
        alibi:'‚Äú‚Ä¶sinyalku putus sebentar. Aku tetap di teras.‚Äù'
      }
    },
    { id:'bima', emoji:'üç≥', name:'Bima Adi', role:'Koki pribadi',
      left:false, shoe:42, perfume:'Citrus',
      bio:'Bekerja di vila tiga tahun terakhir.',
      alibi:'Menyiapkan makan malam sambil live IG.',
      qa:{
        default:'‚ÄúAku di dapur, ada rekaman live.‚Äù',
        relation:'‚ÄúKorban cerewet, tapi baik.‚Äù'
      }
    },
    { id:'sari', emoji:'üë©‚Äçüíº', name:'Sari Wulandari', role:'Sepupu korban',
      left:false, shoe:39, perfume:'Floral',
      bio:'Datang untuk diskusi warisan.',
      alibi:'Rapat Zoom dengan notaris.',
      qa:{
        default:'‚ÄúAku di ruang tamu, panggilan video panjang.‚Äù'
      }
    },
    { id:'dodi', emoji:'üõ°Ô∏è', name:'Dodi Saputra', role:'Satpam',
      left:false, shoe:41, perfume:'Woody',
      bio:'Ronda keliling tiap 15 menit.',
      alibi:'Catatan patroli beruntun tanpa jeda.',
      qa:{
        default:'‚ÄúAku cuma keliling seperti biasa.‚Äù'
      }
    }
  ];

  const LOCATIONS = [
    { id:'study', emoji:'üìö', name:'Ruang Kerja',
      clues:[
        { id:'clue_strikeLeft', key:true, title:'Arah Pukulan',
          text:'Polanya menunjukkan hantaman dari sisi kiri (pelaku kidal).',
          effect: (s)=>{ s.evidence.strike='left'; }
        },
        { id:'clue_cologne', key:true, title:'Jejak Aroma',
          text:'Terdapat aroma parfum malam ‚ÄúNocturne‚Äù.',
          effect: (s)=>{ s.evidence.scent='Nocturne'; }
        },
        { id:'clue_statue', key:false, title:'Patung Retak',
          text:'Patung batu berat dengan noda darah ‚Äî senjata kemungkinan.',
          effect: (s)=>{ s.evidence.weapon='Patung'; }
        }
      ]
    },
    { id:'kitchen', emoji:'üçΩÔ∏è', name:'Dapur',
      clues:[
        { id:'clue_bimaStream', key:true, title:'Live IG Bima',
          text:'Tripod menyala merekam Bima 10.05‚Äì10.25 (alibi kuat).',
          effect:(s)=>{ s.evidence.alibi_bima=true; }
        }
      ]
    },
    { id:'garden', emoji:'üåø', name:'Taman',
      clues:[
        { id:'clue_foot', key:false, title:'Jejak Kecil',
          text:'Jejak sepatu basah ukuran 38‚Äì39 menuju ruang kerja.',
          effect:(s)=>{ s.evidence.foot=[38,39]; }
        }
      ]
    },
    { id:'veranda', emoji:'üì±', name:'Teras',
      clues:[
        { id:'clue_rinaPhone', key:false, title:'Log Telepon Rina',
          text:'Koneksi terputus 10.12‚Äì10.20, celah pada alibi.',
          effect:(s)=>{ s.evidence.rinaPhoneGap=true; }
        }
      ]
    },
    { id:'security', emoji:'üìã', name:'Pos Satpam',
      clues:[
        { id:'clue_guardLog', key:true, title:'Log Patroli',
          text:'Catatan Dodi konsisten tiap 15 menit (alibi kuat).',
          effect:(s)=>{ s.evidence.alibi_dodi=true; }
        }
      ]
    },
    { id:'living', emoji:'üõãÔ∏è', name:'Ruang Tamu',
      clues:[
        { id:'clue_argument', key:false, title:'Pesan Dihapus',
          text:'Restore ponsel: perdebatan tajam korban‚ÄìRina soal artikel.',
          effect:(s)=>{ s.evidence.motive_rina=true; }
        }
      ]
    }
  ];

  // Bukti kunci minimum agar tombol tuduhan aktif
  const REQUIRED_KEY_IDS = ['clue_strikeLeft','clue_cologne','clue_bimaStream','clue_guardLog'];
  const STORAGE_KEY = 'detective-state-v1';

  // ---------- STATE ----------
  const defaultState = () => ({
    found: [],          // id petunjuk
    evidence: {},       // fakta terstruktur
    steps: 0,           // jumlah aksi
    lastLocation: null,
    notes: '',
    questionsLeft: 8
  });
  let state = loadState();

  function loadState(){
    try{
      const raw = localStorage.getItem(STORAGE_KEY);
      if(!raw) return defaultState();
      const s = JSON.parse(raw);
      // sanitasi minimal
      if(!s || typeof s !== 'object') return defaultState();
      return Object.assign(defaultState(), s);
    }catch(e){ return defaultState(); }
  }
  function saveState(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }
  function step(n=1){ state.steps += n; document.getElementById('steps').textContent = state.steps; saveState(); }

  // ---------- UI RENDER ----------
  const el = (sel)=>document.querySelector(sel);
  const $locations = el('#locations');
  const $clueArea = el('#clueArea');
  const $suspects = el('#suspects');
  const $log = el('#log');
  const $progressBadge = el('#progressBadge');
  const $notes = el('#notes');

  function renderLocations(){
    $locations.innerHTML = LOCATIONS.map(loc => `
      <button class="card" data-loc="${loc.id}" aria-label="Buka ${loc.name}">
        <div class="emoji">${loc.emoji}</div>
        <div>
          <div class="name">${loc.name}</div>
          <small>${loc.clues.length} petunjuk</small>
        </div>
      </button>
    `).join('');
  }

  function renderClues(locId){
    const loc = LOCATIONS.find(l=>l.id===locId);
    if(!loc) return;
    state.lastLocation = locId; saveState();
    const items = loc.clues.map(c=>{
      const taken = state.found.includes(c.id);
      return `
      <div class="clue" data-clue="${c.id}">
        <div class="txt">
          <strong>${c.title}</strong><br>
          <span class="muted">${c.text}</span>
        </div>
        <div>
          <button ${taken?'disabled':''} data-act="take">${taken?'Tersimpan':'Ambil'}</button>
        </div>
      </div>`;
    }).join('');
    $clueArea.innerHTML = `<div class="clues">${items}</div>`;
  }

  function computePossible(){
    // Filter suspek berdasarkan evidence yang ada
    let possible = [...SUSPECTS];
    const e = state.evidence;
    if(e.strike==='left'){
      possible = possible.filter(p=>p.left);
    }
    if(e.scent==='Nocturne'){
      possible = possible.filter(p=>p.perfume==='Nocturne');
    }
    if(Array.isArray(e.foot)){
      possible = possible.filter(p=> e.foot.includes(p.shoe));
    }
    if(e.alibi_bima){ possible = possible.filter(p=>p.id!=='bima'); }
    if(e.alibi_dodi){ possible = possible.filter(p=>p.id!=='dodi'); }
    // (Catatan: gap telepon Rina & motif tidak mengeliminasi orang lain‚Äîhanya penguat)
    return possible;
  }

  function renderSuspects(){
    const possible = computePossible().map(p=>p.id);
    $suspects.innerHTML = SUSPECTS.map(p=>{
      const isPossible = possible.includes(p.id);
      const tags = [
        p.left ? '<span class="tag">kidal</span>' : '<span class="tag">kanan</span>',
        `<span class="tag">uk. sepatu ${p.shoe}</span>`,
        `<span class="tag">parfum ${p.perfume}</span>`,
        isPossible ? '<span class="tag ok">MUNGKIN</span>' : '<span class="tag no">TERELIMINASI</span>'
      ].join(' ');
      return `
        <div class="sus">
          <div class="pfp" aria-hidden="true">${p.emoji}</div>
          <div>
            <div class="nm">${p.name}</div>
            <div class="meta">${p.role}</div>
            <div class="tiny muted" style="margin-top:6px">${p.bio}</div>
            <div style="margin-top:8px" class="chips">${tags}</div>
          </div>
        </div>
      `;
    }).join('');
  }

  function renderProgress(){
    const keysFound = state.found.filter(id=>REQUIRED_KEY_IDS.includes(id)).length;
    $progressBadge.textContent = `Bukti kunci: ${keysFound}/${REQUIRED_KEY_IDS.length}`;
    el('#accuseBtn').disabled = keysFound < REQUIRED_KEY_IDS.length;
  }

  function log(msg){
    const p = document.createElement('p');
    p.innerHTML = msg;
    $log.prepend(p);
  }

  // ---------- INTERAKSI ----------
  $locations.addEventListener('click', (e)=>{
    const btn = e.target.closest('[data-loc]');
    if(!btn) return;
    renderClues(btn.dataset.loc);
    step();
  });

  $clueArea.addEventListener('click', (e)=>{
    const clueEl = e.target.closest('[data-clue]');
    if(!clueEl) return;
    const id = clueEl.dataset.clue;
    const act = e.target.getAttribute('data-act');
    if(act!=='take') return;
    if(state.found.includes(id)) return;

    // Temukan petunjuk & terapkan efeknya
    let foundObj = null;
    for(const loc of LOCATIONS){
      const c = loc.clues.find(x=>x.id===id);
      if(c){ foundObj = c; break; }
    }
    if(!foundObj) return;

    try{ foundObj.effect(state); }catch(_){}
    state.found.push(id);
    saveState();
    renderClues(state.lastLocation);
    renderSuspects();
    renderProgress();

    const keyBadge = foundObj.key ? ' <span class="tag ok">BUKTI KUNCI</span>' : '';
    log(`üß© <b>${foundObj.title}</b> tersimpan.${keyBadge}`);
    step();
  });

  // Tuduhan
  el('#accuseBtn').addEventListener('click', ()=>{
    const dlg = el('#accuseModal');
    const possible = computePossible();
    const list = possible.length ? possible : SUSPECTS; // tetap tampilkan semua jika filter terlalu ketat
    el('#accuseList').innerHTML = list.map((p,i)=>`
      <label class="radio"><input type="radio" name="sus" value="${p.id}" ${i===0?'checked':''}>
        <div><b>${p.name}</b><div class="tiny muted">${p.role}</div></div>
      </label>
    `).join('');
    // Bukti kunci yang dipakai
    const proofs = state.found.filter(id=>REQUIRED_KEY_IDS.includes(id));
    el('#proofChips').innerHTML = proofs.map(id=>{
      const loc = LOCATIONS.find(l=>l.clues.find(c=>c.id===id));
      const c = loc.clues.find(x=>x.id===id);
      return `<span class="tag">${c.title}</span>`;
    }).join('') || '<span class="muted tiny">Belum ada.</span>';

    dlg.showModal();
  });

  el('#accuseForm').addEventListener('close', ()=>{
    if(el('#accuseForm').returnValue!=='submit') return;
    const chosen = new FormData(el('#accuseForm')).get('sus');
    // Jawaban benar: Rina
    const correct = 'rina';
    const ok = chosen===correct;

    const result = document.createElement('div');
    result.style.marginTop = '10px';
    if(ok){
      const steps = state.steps;
      const keys = state.found.filter(id=>REQUIRED_KEY_IDS.includes(id)).length;
      const stars = steps <= 18 ? '‚òÖ‚òÖ‚òÖ' : steps <= 26 ? '‚òÖ‚òÖ' : '‚òÖ';
      result.innerHTML = `
        <div class="success">
          <b>Tepat!</b> Pelaku adalah <b>Rina Putri</b>. Motif: konflik artikel & tekanan kerja.
          Senjata: <i>patung batu</i> di ruang kerja.
          <div class="tiny">Alasan: kidal (arah pukulan), jejak parfum ‚ÄúNocturne‚Äù, alibi Bima & Dodi terverifikasi, celah telepon Rina 10.12‚Äì10.20, dan pesan perdebatan.</div>
          <div style="margin-top:6px" class="tiny">Skor: ${stars} ‚Äî langkah ${steps}, bukti kunci ${keys}/${REQUIRED_KEY_IDS.length}.</div>
        </div>`;
      log(result.innerHTML);
    } else {
      result.innerHTML = `<div class="danger"><b>Belum tepat.</b> Bukti yang ada belum cukup mendukung tuduhan tersebut. Kumpulkan lebih banyak bukti kunci lalu coba lagi.</div>`;
      log(result.innerHTML);
    }
    step();
  });

  // Interogasi sederhana
  el('#interrogateBtn').addEventListener('click', ()=>{
    const dlg = el('#askModal');
    el('#qLeft').textContent = state.questionsLeft;
    el('#askOutput').innerHTML = `<div class="tiny muted">Pilih suspek untuk mendengar jawabannya‚Ä¶</div>`;
    el('#askTargets').innerHTML = SUSPECTS.map(p=>`<button data-ask="${p.id}">${p.emoji} ${p.name.split(' ')[0]}</button>`).join('');
    dlg.showModal();
  });
  el('#askForm').addEventListener('click',(e)=>{
    const b = e.target.closest('[data-ask]'); if(!b) return;
    if(state.questionsLeft<=0){ el('#askOutput').innerHTML='<span class="tiny muted">Pertanyaanmu habis.</span>'; return; }
    state.questionsLeft -= 1; saveState();
    el('#qLeft').textContent = state.questionsLeft;
    const id = b.dataset.ask;
    const p = SUSPECTS.find(x=>x.id===id);
    // Jawaban bisa berubah jika bukti tertentu ditemukan
    let answer = p.qa?.default || '‚Ä¶';
    if(id==='rina'){
      if(state.evidence.motive_rina) answer = p.qa.relation;
      if(state.evidence.scent==='Nocturne') answer = p.qa.perfume;
      if(state.evidence.rinaPhoneGap) answer = p.qa.alibi;
    }
    if(id==='bima' && state.evidence.alibi_bima){ answer = p.qa.default + ' (Cek: rekaman tersimpan.)'; }
    if(id==='dodi' && state.evidence.alibi_dodi){ answer = p.qa.default + ' (Log patroli rapi.)'; }

    el('#askOutput').innerHTML = `<b>${p.name}:</b> ‚Äú${answer}‚Äù`;
  });

  // Notebook, salin & reset
  $notes.value = state.notes || '';
  $notes.addEventListener('input', ()=>{ state.notes = $notes.value; saveState(); });
  el('#copyNotes').addEventListener('click', async ()=>{
    try{
      await navigator.clipboard.writeText($notes.value);
      log('üìí Catatan disalin ke clipboard.');
    }catch(_){ log('‚ö†Ô∏è Gagal menyalin catatan.'); }
    step();
  });
  el('#resetBtn').addEventListener('click', ()=>{
    if(confirm('Mulai ulang kasus dan hapus progress?')){
      localStorage.removeItem(STORAGE_KEY);
      state = defaultState();
      boot();
      log('üîÑ Kasus di-reset.');
    }
  });

  // ---------- BOOT ----------
  function boot(){
    renderLocations();
    renderSuspects();
    renderProgress();
    document.getElementById('steps').textContent = state.steps;
    if(state.lastLocation) renderClues(state.lastLocation);
    // tampilkan bukti yang sudah dikumpulkan di log (sekali saat boot)
    if(state.found.length){
      log(`üì¶ Memuat progress: ${state.found.length} bukti tersimpan.`);
    }else{
      log('üïØÔ∏è Korban ditemukan di ruang kerja. Kumpulkan petunjuk, bandingkan dengan profil suspek, lalu ajukan tuduhan.');
    }
  }
  boot();
  </script>
</body>
</html>
